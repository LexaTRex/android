package de.culture4life.luca.testing.provider.opentestcheck;

import android.util.Base64;

import java.security.KeyFactory;
import java.security.NoSuchAlgorithmException;
import java.security.interfaces.RSAPublicKey;
import java.security.spec.InvalidKeySpecException;
import java.security.spec.X509EncodedKeySpec;

class OpenTestCheckPublicKey {

    private final String name;
    private final String encodedPublicKey;
    private RSAPublicKey publicKey;

    public OpenTestCheckPublicKey(String name, String encodedPublicKey) {
        this.name = name;
        this.encodedPublicKey = encodedPublicKey;
    }

    public RSAPublicKey getPublicKey() throws InvalidKeySpecException, NoSuchAlgorithmException {
        if (publicKey == null) {
            this.publicKey = decodePublicKey();
        }
        return publicKey;
    }

    private RSAPublicKey decodePublicKey() throws NoSuchAlgorithmException, InvalidKeySpecException {
        byte[] encoded = Base64.decode(encodedPublicKey, Base64.NO_WRAP);
        KeyFactory keyFactory = KeyFactory.getInstance("RSA");
        return (RSAPublicKey) keyFactory.generatePublic(new X509EncodedKeySpec(encoded));
    }

    public String getName() {
        return name;
    }

}
